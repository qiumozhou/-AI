# 使用教程

## 快速开始

### Windows用户

1. **双击运行 `run.bat`**
2. 选择 `4` 安装依赖
3. 选择 `3` 配置引擎（按提示下载Pikafish）
4. 选择 `1` 启动GUI版本

### Linux/Mac用户

```bash
chmod +x run.sh
./run.sh
```

## 详细步骤

### 第一步：安装Python依赖

```bash
pip install -r requirements.txt
```

如果下载慢，使用国内镜像：
```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 第二步：配置Pikafish引擎

#### 方法1：自动配置（推荐）
```bash
python download_engine.py
```

#### 方法2：手动配置
1. 访问 https://github.com/official-pikafish/Pikafish/releases
2. 下载最新Windows版本
3. 解压后将 `pikafish.exe` 放入 `engine/` 目录

### 第三步：运行程序

#### GUI版本（推荐新手）
```bash
python chess_gui.py
```

特点：
- ✅ 图形界面，操作简单
- ✅ 实时预览棋盘截图
- ✅ 可调节分析参数
- ✅ 日志输出直观

#### 命令行版本（适合高级用户）
```bash
python chess_assistant.py
```

特点：
- ✅ 轻量级，占用资源少
- ✅ 快捷键控制
- ✅ 适合后台运行

## 使用场景

### 场景1：网页象棋对弈辅助

1. 打开象棋对弈网站（如天天象棋、QQ象棋等）
2. 运行程序，按 `Ctrl+S` 开始分析
3. 程序会自动识别棋局并给出建议
4. 根据建议落子

### 场景2：学习象棋

1. 打开象棋教学视频或棋谱
2. 运行程序分析局面
3. 对比引擎建议和视频讲解
4. 理解最佳走法的原因

### 场景3：复盘分析

1. 载入已下完的棋局
2. 使用程序分析每一步
3. 找出失误和改进点
4. 提高棋艺

## 参数调节

### 截图间隔
- **范围**: 1-10秒
- **建议**: 
  - 快棋：1-2秒
  - 慢棋：3-5秒
  - 复盘：可手动截图

### 分析深度
- **范围**: 5-25
- **建议**:
  - 快速分析：depth 10
  - 标准分析：depth 15
  - 深度分析：depth 20+

深度越大，计算时间越长，但分析越准确。

## 识别优化建议

### 提高识别准确率

1. **棋盘位置**
   - 将棋盘放在屏幕中央
   - 避免遮挡
   - 保持完整显示

2. **棋盘大小**
   - 不要太小（建议至少400x400像素）
   - 不要太大（避免超出屏幕）

3. **界面清晰度**
   - 使用高分辨率显示
   - 避免棋盘透明或模糊
   - 关闭干扰特效

4. **颜色对比**
   - 红黑棋子颜色鲜明
   - 背景单一
   - 避免强光反射

### 调试技巧

程序会生成调试图像：
- `debug_board.png` - 识别的棋盘区域
- `debug_warped_board.png` - 透视变换后的棋盘

检查这些图像可以了解识别效果。

## 常见问题

### Q1: 找不到棋盘？
**A**: 
- 确保棋盘完整显示
- 调整棋盘位置到屏幕中央
- 检查debug_board.png查看识别区域

### Q2: 引擎不工作？
**A**:
- 检查engine/pikafish.exe是否存在
- 运行download_engine.py重新配置
- 查看日志中的错误信息

### Q3: 识别的棋子不准确？
**A**:
当前版本使用简化识别，建议：
- 使用标准棋盘界面
- 确保棋子清晰
- 后续版本将改进识别算法

### Q4: 程序卡顿或崩溃？
**A**:
- 降低分析深度
- 增加截图间隔
- 关闭其他占用资源的程序

### Q5: 如何停止程序？
**A**:
- GUI版本：点击"停止分析"按钮或关闭窗口
- 命令行版本：按 `Ctrl+Q`

## 快捷键参考

### 命令行版本
- `Ctrl + S` - 开始/暂停分析
- `Ctrl + Q` - 退出程序

### GUI版本
- `Ctrl + S` - 开始/停止分析
- `Ctrl + Q` - 退出程序

## 进阶使用

### 自定义分析区域

在 `chess_assistant.py` 中修改：
```python
# 只截取屏幕特定区域
region = (x, y, width, height)  # 自定义坐标
screen = self.capture_screen(region=region)
```

### 调整引擎参数

在 `chess_assistant.py` 的 `analyze_position` 方法中：
```python
commands = [
    "setoption name Hash value 512\n",  # 增加哈希表大小
    "setoption name Threads value 4\n",  # 使用多线程
    "go depth 20\n",  # 增加搜索深度
    # "go movetime 5000\n",  # 或限制思考时间（毫秒）
]
```

### 保存分析记录

程序可以扩展为保存每次分析：
```python
# 在 analyze_position 后添加
with open("analysis_log.txt", "a", encoding="utf-8") as f:
    f.write(f"{time.ctime()}: {fen} -> {best_move}\n")
```

## 性能优化

### 提高速度
1. 使用固定截图区域（不全屏截图）
2. 降低分析深度
3. 增加截图间隔

### 提高准确性
1. 增加分析深度
2. 使用更大的引擎哈希表
3. 改进棋子识别算法

## 法律和道德提醒

⚠️ **重要提醒**：

1. **学习用途**: 本程序设计用于学习和研究
2. **禁止作弊**: 请勿在正式比赛或排位赛中使用
3. **遵守规则**: 使用前请阅读对弈平台的服务条款
4. **个人责任**: 不当使用造成的后果自负

建议用途：
- ✅ 个人练习和学习
- ✅ 棋局复盘分析
- ✅ 研究象棋理论
- ❌ 在线对弈作弊
- ❌ 参加比赛时使用

## 技术支持

如遇到问题：
1. 查看本文档的常见问题部分
2. 检查程序日志输出
3. 查看debug图像文件

## 更新日志

### v1.0 (当前版本)
- ✅ 基础截图功能
- ✅ Pikafish引擎集成
- ✅ GUI和命令行两种模式
- ✅ 简化的棋子识别
- ⏳ 完整的AI识别（开发中）

### 计划功能
- 🔄 基于深度学习的棋子识别
- 🔄 多引擎对比分析
- 🔄 棋局记录和回放
- 🔄 移动端支持

