# 棋子识别功能说明

## 🎯 识别方式

程序现在支持两种方式来分析棋局：

### 方式1：自动识别（已实现）⭐
通过颜色检测自动识别屏幕上的棋盘。

**工作原理**：
1. 截取棋盘区域
2. 将棋盘分成9x10的格子
3. 检测每个格子中的红色/黑色棋子
4. 根据位置推断棋子类型
5. 生成FEN格式并发送给引擎分析

**适用场景**：
- ✅ 标准棋盘样式
- ✅ 红黑棋子颜色鲜明
- ✅ 背景单一
- ✅ 初始局面或中局

**限制**：
- ⚠️ 仅基于位置推断棋子类型（适合开局到中局）
- ⚠️ 残局可能识别不准确
- ⚠️ 3D棋盘或特殊样式可能无法识别

### 方式2：手动输入FEN（已实现）⭐⭐
直接输入FEN格式的棋局进行分析。

**使用方法**：
1. 从象棋软件获取FEN格式
2. 粘贴到程序的"手动输入局面"输入框
3. 点击"分析此局面"按钮
4. 查看引擎给出的最佳走法

**优点**：
- ✅ 100%准确
- ✅ 支持任何局面
- ✅ 支持残局
- ✅ 不受棋盘样式限制

## 📖 如何获取FEN格式

### 从天天象棋
1. 打开对局
2. 点击"分享"按钮
3. 选择"复制FEN"
4. 粘贴到程序中

### 从象棋巫师
1. 菜单 -> 局面 -> 粘贴局面
2. 选择FEN格式
3. 复制内容

### 从在线象棋网站
大多数在线象棋网站都支持导出FEN格式：
- XQinenglish.com
- Xiangqi.com
- 中国象棋网

## 🔧 识别优化建议

### 提高自动识别准确率

1. **棋盘位置**
   - 将棋盘放在屏幕中央
   - 确保完整显示，不要有遮挡
   - 避免棋盘边缘被截断

2. **棋盘样式**
   - 使用标准2D棋盘
   - 避免3D或透视效果
   - 选择红黑棋子颜色鲜明的皮肤

3. **背景环境**
   - 单一背景色
   - 避免强光反射
   - 关闭动画和特效

4. **图像质量**
   - 棋盘不要太小（至少400x400像素）
   - 不要太大（避免超出屏幕）
   - 保持图像清晰

### 调试识别问题

程序会生成调试图像：
- `debug_board.png` - 识别的棋盘区域
- `debug_board_original.png` - 处理后的棋盘图像

查看这些图像可以了解识别效果。

## 🎯 使用场景建议

| 场景 | 推荐方式 | 说明 |
|------|----------|------|
| 开局 | 自动识别 | 位置推断准确 |
| 中局 | 自动识别 | 基本可用 |
| 残局 | 手动FEN | 更准确 |
| 学习/复盘 | 手动FEN | 方便快捷 |
| 在线对弈 | 自动识别 | 实时分析 |
| 特殊棋盘 | 手动FEN | 兼容性好 |

## 🚀 未来改进方向

### v2.0 计划功能
- [ ] **深度学习识别**
  - 使用YOLOv8训练专用模型
  - 识别棋子上的汉字
  - 支持各种棋盘样式
  - 准确率>95%

- [ ] **智能棋盘检测**
  - 自动检测棋盘边界
  - 透视变换校正
  - 自适应不同尺寸

- [ ] **OCR文字识别**
  - 识别棋子上的汉字
  - 区分"将/帅"、"象/相"、"士/仕"
  - 支持不同字体

## 💡 使用技巧

### 技巧1：快速测试识别
1. 打开象棋软件摆好棋局
2. 运行程序，点击"立即截图"
3. 查看`debug_board_original.png`
4. 如果棋子识别正确，使用自动识别
5. 如果不准确，切换到手动FEN

### 技巧2：组合使用
1. 使用自动识别获取大致局面
2. 查看识别的FEN
3. 如有错误，手动修正FEN
4. 粘贴修正后的FEN分析

### 技巧3：创建FEN库
将常用的开局、定式保存为FEN格式：
```
# 中炮对屏风马
rnbakabnr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RNBAKABNR w - - 0 1

# 飞相局
rnbakabnr/9/1c5c1/p1p1p1p1p/9/2B6/P1P1P1P1P/1C5C1/9/RNBAKAB1R w - - 0 1
```

## ❓ 常见问题

### Q: 为什么识别的棋子不对？
A: 
- 当前识别基于位置推断，适合标准开局
- 中残局可能不准确
- 建议使用手动FEN输入

### Q: 如何验证识别是否正确？
A: 
- 查看程序输出的FEN
- 对比棋盘实际局面
- 使用在线FEN查看器验证

### Q: 可以识别非标准局面吗？
A: 
- 自动识别仅支持基于位置的推断
- 非标准局面请使用手动FEN输入

### Q: 支持哪些棋盘样式？
A: 
- 自动识别：2D标准棋盘
- 手动FEN：支持所有样式

## 📞 技术支持

如果遇到识别问题：
1. 查看调试图像
2. 尝试调整棋盘位置
3. 尝试手动FEN输入
4. 在GitHub提交Issue

---

**提示**：当前版本（v1.0）的识别功能已经可以应对大多数场景，但还有改进空间。我们正在开发基于深度学习的v2.0版本，敬请期待！

